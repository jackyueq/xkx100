// lonely-sword.c ¶À¹Â¾Å½£
// Last Modified by sir 10.22.2001

#include <ansi.h>
#include <combat.h>
inherit SKILL;
string type() { return "martial"; }
string martialtype() { return "skill"; }
int action_po(object me, object victim, object weapon, int damage);
int action_busy(object me, object victim, object weapon, int damage);
int action_damage(object me, object victim, object weapon, int damage);
int action_parry(object me, object victim, object weapon, int damage);
int action_dodge(object me, object victim, object weapon, int damage);
int action_spbusy(object me, object victim, object weapon, int damage);
int action_spdamage(object me, object victim, object weapon, int damage);
int action_spparry(object me, object victim, object weapon, int damage);
int action_spdodge(object me, object victim, object weapon, int damage);

string *order = ({""HIY"", ""HIG"", ""RED"", ""MAG"", ""YEL"", ""HIC"", ""HIW"", ""HIR"",""HIB"", ""CYN"",""WHT"",""HIM"",""BLU""});

string *parry_msg = ({
	"È´¼û$nÌ¤Ç°Ò»²½£¬½£Ê½Ð±Ö¸ÄãµÄÓÒ±Û£¬ÏëÒªÊ¹$PÉÁÉí¶øÍË¡£\n",
	"$nÒÔ¹¥ÎªÊØ£¬ÒÔ½øÎªÍË£¬ÄýÉñÔËÆøÏò$PÃÍ¹¥¿ì´òµØ»Ó³ö·½Î»´óÒìµÄÌ©É½"+(order[random(13)])+"¡¸¿ì»îÈý¡¹"NOR"Èý½£¡£\n",
	"$n½£·¨Í»±ä£¬½£ÊÆÉìËõ²»¶¨£¬±¼ÌÚ½ÃØ²£¬ÄæÊ¹áÔÉ½½£·¨µÄ"+(order[random(13)])+"¡¸ÌìÍâÓñÁú¡¹"NOR"ÆóÍ¼ÆÈÊ¹$P±äÕÐ¡£\n",
	"$nÍ»È»Ò»½£µãÏò$PµÄ$l£¬ËäÒ»½£È´°µ²ØÎÞÊýºó×Å£¬$PÊÖ×ãÎÞ´ë£¬¹¥ÊÆ²»ÓÉ×ÔÖ÷Í£ÁËÏÂÀ´£¡\n"
	"$n²»ÉÁ²»±Ü£¬¾Ù½£ÉÁµç°ãÊ¹³ö"+(order[random(13)])+"¡¸µþ´ä¸¡Çà¡¹"NOR"·´Ï÷$PµÄ$l£¬Ïëµ²¹ýÄã´ËÕÐ¡£\n",
	"$nÍ»È»Ê¹³öÇà³ÇÅÉËÉ·ç½£·¨µÄ"+(order[random(13)])+"¡¸ºè·ÉÚ¤Ú¤¡¹"NOR"£¬¿ÉÊÇ·½Î»È´ÓÐËùÆ«²î£¬³¤½£¶Ô×Å$PÒ»½Ê£¬Æó\nÍ¼Í»ÆÆ$PµÄ¹¥ÊÆ£¡\n"
	"$nÍ¦½£Ò»ÕÐÏóÊÇ"+(order[random(13)])+"¡¸°×ÔÆ³öá¶¡¹"NOR"»Ø´Ì$PµÄ$l£¬ÆóÍ¼½«$PµÄ¹¥ÊÆ»¯½â¡£\n",
	"Ö»¼û$n²»ÍË·´½ø£¬ÉíÈçÆ®·ç£¬¹îÒìµØÒ»Ê½"+(order[random(13)])+"¡¸ÌìÖùÔÆÆø¡¹"NOR"£¬¶¯ÏòÎÞ¶¨²»¿É×½ÃþµØµ²×¡ÁË$PµÄ\n½ø¹¥¡£\n",
	"$n²»ÍË·´½ø£¬Ê¹³öºãÉ½½£ÕÐ"+(order[random(13)])+"¡¸ÃàÀï²ØÕë¡¹"NOR"£¬É­É­½£Æø³äÒçËÄÖÜ£¡¼Ü¿ªÁË$PµÄÕâÕÐ\n",
});

mapping *action = ({
([	"action" : "µ«¼û$NÍ¦Éí¶øÉÏ£¬$wÒ»Ðý£¬Ò»ÕÐ·Â·ðÌ©É½½£·¨µÄ"+(order[random(13)])+"¡¸À´º×ÇåÈª¡¹"NOR"Ö±´Ì$n
µÄ$l£¡",
	"lvl" : 0,
	"skill_name" : "À´º×ÇåÈª"
]),
([	"action" : "$NÆæ¹îµØÏò$n»Ó³ö"+(order[random(13)])+"¡¸ÈªÃùÜ½ÈØ¡¹"NOR"¡¢"+(order[random(13)])+"¡¸º×Ïè×Ï¸Ç¡¹"NOR"¡¢"+(order[random(13)])+"¡¸Ê¯âÞÊéÉù¡¹"NOR"¡¢"+(order[random(13)])+"¡¸
ÌìÖùÔÆÆø¡¹"NOR"¼°"+(order[random(13)])+"¡¸Ñã»Ø×£ÈÚ¡¹"NOR"ºâÉ½ÎåÉñ½££¡",
	"lvl" : 10,
	"skill_name" : "ºâÉ½ÎåÉñ½£"
]),
([
	"action" : "$N½£ËæÉí×ª£¬Ðø¶ø´Ì³öÊ®¾Å½££¬¾¹È»ÊÇ»ªÉ½"+(order[random(13)])+"¡¸ÓñÅ®Ê®¾Å½£¡¹"NOR"£¬µ«ÆæµÄ
ÊÇÕâÊ®¾Å½£±ãÈçÒ»ÕÐ£¬ÊÖ·¨Ö®¿ì£¬Ö±ÊÇ·ËÒÄËùË¼£¡",
	"lvl" : 20,
	"skill_name" : "ÓñÅ®Ê®¾Å½£"
]),
([	"action" : "$N½£ÊÆºö»º¶ø²»Êè£¬½£ÒâÓÐÓà¶ø²»¾¡£¬»¯ºãÉ½½£·¨ÎªÒ»½££¬Ïò$nÂýÂý
ÍÆÈ¥£¡",
	"lvl" : 30,
	"skill_name" : "ºãÉ½½£·¨"
]),
([	"action" : "$N½«$wËæÊÖÒ»°Ú£¬µ«¼û$n×Ô¼ºÏò$w×²½«ÉÏÀ´£¬Éñ½£Ö®Íþ£¬ÊµÈËËùÄÑ²â£¡",
	"lvl" : 40,
	"skill_name" : "Éñ½£Ö®Íþ"
]),
([	"action" : "$NÍÂÆø¿ªÉù£¬Ò»ÕÐËÆÊÇ"+(order[random(13)])+"¡¸¶ÀÅü»ªÉ½¡¹"NOR"£¬ÊÖÖÐ$wÏòÏÂÕ¶Âä£¬Ö±ÅüÏò$nµÄ
$l£¡",
	"lvl" : 50,
	"skill_name" : "¶ÀÅü»ªÉ½"
]),
([	"action" : "$Nº¬Ð¦±§½££¬ÆøÊÆ×¯ÑÏ£¬$wÇá»Ó£¬¾¡ÈÚ"+(order[random(13)])+"¡¸´ïÄ¦½£¡¹"NOR"ÎªÒ»Ê½£¬ÏÐÊæµØ´Ì
Ïò$n£¡",
	"lvl" : 60,
	"skill_name" : "´ïÄ¦½£"
]),
([	"action" : "$NÉñÉùÄýÖØ£¬$wÉÏÅüÏÂÇÐ×óÓÒºáÉ¨£¬Ð®À×öªÍò¾ûÖ®ÊÆ±ÆÍù$n£¬"+(order[random(13)])+"¡¸·üÄ¦
½£¡¹"NOR"µÄ½£Òâ±íÂ¶ÎÞÒÅ£¡",
	"lvl" : 70,
	"skill_name" : "·üÄ¦½£"
]),
([	"action" : "È´¼û$NÍ»È»Ðé²½ÌáÑü£¬Ê¹³ö¿áËÆÎäµ±"+(order[random(13)])+"¡¸òßòÑµãË®¡¹"NOR"µÄÒ»ÕÐ£¡",
	"lvl" : 80,
	"skill_name" : "òßòÑµãË®"
]),
([	"action" : "$NÔË½£Èç·ç£¬½£¹â»ô»ôÖÐ·´¹¥$nµÄ$l£¬³¢ÊÔ±Æ$n×ÔÊØ£¬½£ÕÐËÆÊÇ"+(order[random(13)])+"¡¸·ü
Ä§½£¡¹"NOR"µÄ"+(order[random(13)])+"¡¸ÁúÍÌÊ½¡¹"NOR"¡£",
	"lvl" : 90,
	"skill_name" : "ÁúÍÌÊ½"
]),
([	"action" : "$N±§½£ÐýÉí£¬×ªµ½$nÉíºó£¬ÔÓÂÒÎÞÕÂµØÏò$n´Ì³öÒ»½££¬²»ÖªÊ¹µÄÊÇÊ²
Ã´½£·¨£¡",
	"lvl" : 100,
	"skill_name" : "ÔÓÂÒÎÞÕÂ"
]),
([	"action" : "$N½£Ð®µ¶ÊÆ£¬´ó¿ª´óãØµØÂÒ¿³Ò»Í¨£¬µ«ÕÐÕÐ½Ô»÷ÔÚ$n¹¥ÊÆµÄÆÆÕÀ£¬ÆÈ
µÃ$n²»µÃ²»ÊØ£¡",
	"lvl" : 110,
	"skill_name" : "´ó¿ª´óãØ"
]),
([	"action" : "$N·´ÊÖºá½£´ÌÏò$nµÄ$l£¬ÕâËÆÓÐÕÐËÆÎÞÕÐµÄÒ»½££¬ÍþÁ¦¾¹È»Ææ´ó£¬$n
ÄÑÒÔ¿´Çå½£ÕÐÀ´ÊÆ£¡",
	"lvl" : 120,
	"skill_name" : "ÓÐÕÐËÆÎÞÕÐ"
]),
([	"action" : "$N¾Ù½£¿ñ»Ó£¬Ñ¸ËÙÎÞ±ÈµØµãÏò$nµÄ$l£¬È´ÁîÈË¿´²»³öÆäËùÓÃÊÇÊ²Ã´ÕÐ
Ê½¡£",
	"lvl" : 130,
	"skill_name" : "¾Ù½£¿ñ»Ó"
]),
([	"action" : "$NÍ»È»ÔË½£Èç¿ñ£¬Ò»ÊÖ¹ØÍâµÄ"+(order[random(13)])+"¡¸ÂÒÅû·ç½£·¨¡¹"NOR"£¬ÃÍÈ»Ïò$nÖÜÉíÂÒ´ÌÂÒ
Ï÷£¡",
	"lvl" : 140,
	"skill_name" : "ÂÒÅû·ç½£·¨"
]),
([	"action" : "$NÂú³¡ÓÎ×ß£¬¶«´ÌÒ»½££¬Î÷´ÌÒ»½££¬Áî$nÄªÃ÷ÆäÃî£¬·Ö²»³ö$N½£·¨µÄ
ÐéÊµ£¡",
	"lvl" : 150,
	"post_action" : (: action_dodge :),
	"skill_name" : "ÄªÃ÷ÆäÃî"
]),
([	"action" : "È´¼û$NÉíËæ½£×ß£¬×ó±ßÒ»¹Õ£¬ÓÒ±ßÒ»Íä£¬½£ÕÐÒ²ÊÇÔ½×ªÔ½¼ÓºÝÀ±£¬¾¹
»¯"+(order[random(13)])+"¡¸Ì©É½Ê®°ËÅÌ¡¹"NOR"ÎªÒ»½£¹¥Ïò$n£¡",
	"lvl" : 160,
	"post_action" : (: action_damage :),
	"skill_name" : "Ì©É½Ê®°ËÅÌ"
]),
([	"action" : "$NÍ»È»Ò»½£µãÏò$nµÄ$l£¬ËäÒ»½£È´°µ²ØÎÞÊýºó×Å£¬$nÊÖ×ãÎÞ´ë£¬²»Öª
ÈçºÎÊÇºÃ£¡",
	"post_action" : (: action_busy :),
	"lvl" : 170,
	"skill_name" : "°µ²ØÎÞÊý"
]),
([	"action" : "$NÁ³ÉÏÍ»ÏÖÐ¦ÈÝ£¬ËÆºõÒÑ¿´ÆÆ$nµÄÎä¹¦ÕÐÊ½£¬ÐØÓÐ³ÉÖñµØÒ»½£´ÌÏò$n
µÄ$l£¡",
	"post_action" : (: action_parry :),
	"lvl" : 180,
	"skill_name" : "Í»ÏÖÐ¦ÈÝ"
]),
([	"action" : "$NÊÖÖÐ$wÔ½×ªÔ½¿ì£¬Ê¹µÄ¾ÓÈ»ÊÇºâÉ½µÄ"+(order[random(13)])+"¡¸°Ù±äÇ§»ÃÔÆÎíÊ®ÈýÊ½¡¹"NOR"£¬½£
Ê½ÓÐÈçÔÆ¾íÎíÓ¿£¬ÅÔ¹ÛÕß²»ÓÉµÃÄ¿ÎªÖ®Ñ££¡",
	"lvl" : 190,
	"post_action" : (: action_spdodge :),
	"skill_name" : "°Ù±äÇ§»ÃÔÆÎíÊ®ÈýÊ½"
]),
([	"action" : "$N½£ÒâÍ»»ÀÆøÏóÉ­ÑÏ£¬±ãËÆÇ§¾üÍòÂí±¼³Û¶øÀ´£¬³¤Ç¹´óêª£¬»ÆÉ³Ç§Àï
£¬¾¡À¨áÔÉ½½£ÊÆ»÷Ïò$nµÄ$l£¡",
	"lvl" : 200,
	"post_action" : (: action_spdamage :),
	"skill_name" : "³¤Ç¹´óêª"
]),
([	"action" : "$N¾ÙÆð$wÔËÊ¹"+(order[random(13)])+"¡¸Ì«¼«½£¡¹"NOR"½£Òâ£¬»®³ö´ó´óÐ¡Ð¡ÎÞÊý¸öÔ²È¦£¬ÎÞÇîÎÞ¾¡
Ô´Ô´²»¾øµØ²øÏò$n£¡",
	"post_action" : (: action_spbusy :),
	"lvl" : 210,
	"skill_name" : "Ì«¼«½£"
]),
([	"action" : "$N½£ÕÐÍ»±ä£¬Ê¹³öºâÉ½µÄ"+(order[random(13)])+"¡¸Ò»½£Âä¾ÅÑã¡¹"NOR"£¬Ï÷Ïò$nµÄ$l£¬ÔõÖª½£µ½ÖÐ
Í¾£¬Í»È»×ªÏò£¬´ó³ö$nÒâÁÏÖ®Íâ£¡",
	"lvl" : 220,
	"post_action" : (: action_spparry :),
	"skill_name" : "Ò»½£Âä¾ÅÑã"
]),
([	"action" : "$NËæÊÖÒ»½£Ö¸Ïò$n£¬ÂäµãÕýÊÇ$nµÄÆÆÕÀËùÔÚ£¬¶ËµÄÊÇÉñÃîÎÞÂ×£¬²»¿É
Ë¼Òé£¡",
	"post_action" : (: action_po :),
	"lvl" : 230,
	"skill_name" : "ÉñÃîÎÞÂ×"
]),
});

int valid_enable(string usage) { return usage=="sword" || usage=="parry"; }
string query_parry_msg(string limb)
{
	return parry_msg[random(sizeof(parry_msg))];
}
int valid_learn(object me)
{
	object ob;

	mapping myfam;
	myfam = (mapping)me->query("family");
	if(!myfam || myfam["family_name"] != "»ªÉ½ÅÉ"|| myfam["master_id"] != "feng qingyang")
		return notify_fail("¶À¹Â¾Å½£Ö»ÓÐÏò·çÇåÑïÀÏÇ°±²Ñ§Ï°¡£\n");
	if( (int)me->query("max_neili") < 600 )
		return notify_fail("ÄãµÄÄÚÁ¦²»¹»£¬Ã»ÓÐ°ì·¨Á·¶À¹Â¾Å½£¡£\n");
	if( (int)me->query_skill("zixia-shengong",1)<100)
		return notify_fail("¶À¹Â¾Å½£±ØÐëÅäºÏ×ÏÏ¼Éñ¹¦²ÅÄÜÁ·Ï°¡£\n");
	if( !(ob = me->query_temp("weapon"))
	|| (string)ob->query("skill_type") != "sword" )
		return notify_fail("Äã±ØÐëÏÈÕÒÒ»°Ñ½£²ÅÄÜÁ·½£·¨¡£\n");
	if ((int)me->query_skill("lonely-sword",1) > 120)
		return notify_fail("ÕâÌ×½£·¨ÎÒ¾Í½Ìµ½Õâ¶ù£¬ÒÔºó¾ÍÒª¿¿Äã×Ô¼ºÁ·ÁË¡£\n");

	return 1;
}
int practice_skill(object me)
{
	return notify_fail("¶À¹Â¾Å½£Ö»ÄÜÍ¨¹ý¡¸×Ü¾÷Ê½¡¹À´ÑÝÁ·¡£\n");
}
string query_skill_name(int level)
{
	int i;
	for(i = sizeof(action); i > 0; i--)
		if(level >= action[i-1]["lvl"])
			return action[i-1]["skill_name"];
}
mapping query_action(object me, object weapon)
{
/* d_e=dodge_effect p_e=parry_effect f_e=force_effect m_e=damage_effect */
	int d_e1 = -25;
	int d_e2 = -5;
	int p_e1 = -55;
	int p_e2 = -35;
	int f_e1 = 150;
	int f_e2 = 230;
	int m_e1 = 220;
	int m_e2 = 320;
	int i, lvl, seq, ttl = sizeof(action);

	lvl = (int) me->query_skill("lonely-sword", 1);
	for(i = ttl; i > 0; i--)
		if(lvl > action[i-1]["lvl"])
		{
			seq = i; /* »ñµÃÕÐÊýÐòºÅÉÏÏÞ */
			break;
		}
	seq = random(seq);       /* Ñ¡Ôñ³öÊÖÕÐÊýÐòºÅ */
	return ([
		"action"      : action[seq]["action"],
		"dodge"       : d_e1 + (d_e2 - d_e1) * seq / ttl,
		"parry"       : p_e1 + (p_e2 - p_e1) * seq / ttl,
		"post_action" : action[seq]["post_action"],
		"force"       : f_e1 + (f_e2 - f_e1) * seq / ttl,
		"damage"      : m_e1 + (m_e2 - m_e1) * seq / ttl,
		"damage_type" : random(2) ? "¸îÉË" : "´ÌÉË",
	]);
}

int action_spbusy(object me, object victim, object weapon, int damage)
{
        int skill= me->query_skill("lonely-sword", 1);
        if( damage <= 0 && !victim->is_busy() 
            && me->query("neili") > 100
            && random(me->query("combat_exp")) > victim->query("combat_exp")/3 ) //ÍþÁ¦¼«Ð¡,Èç¹ûÃ»ÓÐÉÏÁ½¸ö Ôò°üÀ¨¶ã¹ýºÍÕÐ¼Ü
        {
         me->add("neili",-30);
         message_combatd("[1;37m$N[1;37m¶ÙÈ»ÁìÎòÁË¡¸½£ÔÚÉñÏÈ, ÃàÃà²»¾ø¡¹Ö®ÕæÒâ, ½£¼âË²¼ä±¬³öÎÞÊý´ó´óÐ¡Ð¡, Õý·´Ð±Ö±¸÷ÖÖ¸÷ÑùµÄÔ²È¦, ½«$n[1;37mÍÅÍÅÀ§×¡[0m\n",me,victim);
         victim->start_busy(1+random(skill/50));
       	return 1;
        }
        return 1;
}

int action_spdamage(object me, object victim, object weapon, int damage)
{
        int skill= me->query_skill("lonely-sword", 1);

	      if( damage == RESULT_DODGE && !victim->is_busy()
	            && skill > 100
	            && me->query("neili") > 100
	            && random(skill) > victim->query_skill("force",1)/2 ) //¶ã¹ý
        {
        	me->add("neili",-30);
        	message_combatd("[1;37m$N[1;37m³¤Ð¥µÀ:¡¸½£ÐýÀëÉí£¬½£Ð¥ÕðÉ½ºÓ¡¹, Ë²¼ä½£Ã¢´ó×÷,³¯$n[1;37m¼¤Éä¶øÖÁ[0m\n",me,victim);
          victim->receive_damage("qi",-skill*2);
          COMBAT_D->report_status(victim);
          return 1;
        }
        return 1;

}
int action_damage(object me, object victim, object weapon, int damage)
{
        int skill= me->query_skill("lonely-sword", 1);

        if (  damage > 0 && !victim->is_busy()
	            && skill > 100
	            && me->query("neili") > 100
	            && random(skill) > victim->query_skill("force",1)/4)   //´òÖÐ¶Ô·½
        {
        	me->add("neili",-30);
          message_combatd("[1;37m$N[1;37mÍ»È»Îò³ö¡¸Á·¾«»¯Æø, Á·Æø»¯Éñ, Á·Éñ»¹Ðé¡¹Ö®ÕæÀí, ÊÖÖÐ³¤½£Í»È»ÏûÊ§, ¾¹ÒÑ³¯$n[1;37m·ÉÖÁ[0m\n",me,victim);
          victim->receive_damage("qi",-skill);
          COMBAT_D->report_status(victim);
        	return 1;
        }
        return 1;

}
int action_spparry(object me, object victim, object weapon, int damage)
{
       string msg;
       if (damage == RESULT_DODGE &&
           random(me->query_skill("lonely-sword",1)) > 140 &&	
	         random(me->query_skill("sword",1))>140 &&
           me->query_skill("force",1) > 200 
           && !victim->is_busy())	
         {
        
           me->add("neili", -50);
           victim->map_skill("parry");
           if( !victim->is_busy() )
           {
             victim->start_busy(random(2)+1);
           }
           msg = HIC "$n¾Ù½£·´¹¥£¬ºó·¢ÏÈÖÁµØ´ÌÏò$N£¬²»½ö°Ñ$NÕÐÊõ·âËÀ£¬¸ü½øÒ»²½·¢³ö¹¥»÷£¡" NOR;
           msg += HIY"$nÄÑÒÔ¿´Çå½£ÕÐÀ´ÊÆ,¾¹È»ÍüÁËÕÐ¼Ü£¡\n"NOR;
           message_combatd(msg,victim,me);
        }
}

int action_spdodge(object me, object victim, object weapon, int damage)
{
	     string msg;
        if (random(me->query_skill("lonely-sword",1)) > 200 &&
            random(me->query_skill("sword",1))>180 &&
          	me->query_skill("force",1) > 250 
           	&& !victim->is_busy())
       {
          me->add("neili", -50);
          victim->map_skill("dodge");
         if( !victim->is_busy() )
         {
           victim->start_busy(random(3)+1);
         }
         msg = HIC "$nÍ»È»¾Ù½£Ò»´Ì£¬½£ÕÐËæ±ãÎÞÕÂ£¬È´ÄªÃ÷ÆæÃîµØÍ»ÆÆÁË$NµÄ¹¥ÊÆ£¬´ó³ö$NÒâÁÏ£¡" ;
         msg += HIR"$n´ó³ÔÒ»¾ª£¬¾¹È»ÍüÁËÉÁ±Ü£¡\n"NOR;
         message_combatd(msg,victim,me);
       }

}

int action_po(object me, object victim, object weapon, int damage)
{
	// ÆÆ¶Ô·½Îä¹¦¡¢ÄÚ¹¦  ÎªÖÕ¼«Ð§¹û
	      int skill= me->query_skill("lonely-sword", 1);
        string v_force = victim->query_skill_mapped("force");
        int jiali;
	      if (damage > 0)// ´òÖÐ¶Ô·½ ÆÆÄÚ¹¦ »òÕßÆÆÄÚÁ¦
	      {
	      	if (v_force && skill > 250 
	      	   && skill/2 > random(victim->query("force")) && 
	      	   random(3)==1)
	      	{
	      		me->add("neili",-100);
	      		victim->map_skill("force");
            message_combatd(HIC "$NÒ»½£µÃÊÖ£¬½£ÕÐÔ´Ô´¶ø³ö£¬½«$nÍÅÍÅÀ§×¡£¡\n",me,victim);
            message_combatd(RED "$nÖ»¾õ»ìÉíÈçÔâµç»÷£¬ÕæÆø¾¢Á¦ÎÉÂÒÄÑ¿Ø£¬ÒÑÈ»²»ÄÜÊ©Õ¹"+to_chinese(skill)+"£¡\n" NOR,me,victim);
	        return 1;
	        }
	        else if (random(me->query_skill("lonely-sword",1)) > 100 &&
          random(me->query_skill("sword",1))>100 &&
         	me->query_skill("force",1) > 120
      	  && !victim->is_busy() )	
          {
          	me->add("neili",-50);
            if (victim->query("neili")>600)
               victim->add("neili", -500);
            else
               victim->set("neili",0);
          message_combatd(HIC "$NÒ»½£µÃÊÖ£¬½£ÕÐÔ´Ô´¶ø³ö£¬½«$nÍÅÍÅÀ§×¡£¡\n",me,victim);
          message_combatd(HIM "$n¼±ÔËÄÚÁ¦£¬Ê¹³ö»ëÉí½âÊý£¬·½²ÅÍÑ³ö½£È¦£¡\n"NOR, victim , me);
          return 1;
          }        
	      }
        else if( damage == RESULT_DODGE ) //¶ã¹ý  ÕðÉå¶Ô·½
        {
        	me->add("neili",-10);
        	message_combatd(HIY "$nÖ»¾õ$N½£ÖÐ°µ²ØÎÞÊýÐþ»ú£¬ÉÔÒ»µ¨ÇÓ£¬²»¸Ò¹¥ÉÏÇ°È¥£¡\n",me,victim);
          victim->start_busy(2);
        	return 1;
        }
        else if ( damage == RESULT_PARRY ) //¶ÔÊÖÕÐ¼Ü×¡ ¿ÉË³ÊÆÔÙ´´¶ÔÊÖ
        {
        	jiali = me->query("jiali");
          if (!jiali) jiali=10;
	        if( random(skill)>140 )
	        {
	        	me->add("neili",-50);
            message_combatd(HIC "$NÏà½»Ò»ÕÐ£¬ÒÑ¿´ÆÆ$nÎä¹¦Ì×Â·£¬ÐØÓÐ³É×ãÓÖ´Ì³öÒ»½£!\n");
	          victim->receive_wound("qi", (random(jiali)+200));
	          message_combatd(HIM"$N½£Æø×Ýºá! Ò»µÀ½£Æø»®¹ýÁË$nµÄ$l¡£½á¹ûÏÊÑª¿ñ±¼!\n"NOR);
            COMBAT_D->report_status(victim,1);
           }
        	return 1;
        }
        return 1;
	
}

int learn_bonus() { return 0; }
int practice_bonus() { return 0; }
int success() { return 5; }
int power_point() { return 1.0; }

int valid_effect(object me, object weapon, string name, int skill)
{
}
string perform_action_file(string action)
{
	return __DIR__"lonely-sword/" + action;
}

int help(object me)
{
	write(HIC"\n¶À¹Â¾Å½££º"NOR"\n");
	write(@HELP

    ¡°¶À¹Â¾Å½££¬ÓÐ½øÎÞÍË£¡¡±
    ´´ÖÆÕâÌ×½£·¨µÄ¶À¹ÂÇó°ÜÇ°±²£¬Ãû×Ö½Ð×ö¡®Çó°Ü¡¯£¬Ëû±ÏÉúÏë
ÇóÒ»°Ü¶ø²»¿ÉµÃ£¬Õâ½£·¨Ê©Õ¹³öÀ´£¬ÌìÏÂÎÞµÐ£¬µ±ÄêËûÕÌ½£½­ºþ£¬
ÎÞµÐÓÚÌìÏÂ£¬Á¬ÕÒÒ»¸ö¶ÔÊÖÀ´±ÆµÃËû»ØÊØÒ»ÕÐ¶¼²»¿ÉµÃ£¬Î¯ÊµÁîÈË
¿É¾ª¿ÉÅå¡£
    ÎÞÕÐÊ¤ÓÐÕÐ£¬µÐÇ¿ÎÒ¸üÇ¿¡£¶À¹Â¾Å½£²»º¬ÕÐÊ½£¬ÓÐÕÐ¼ÈÎÞÕÐ£¬
ÎÞÕÐÒàÓÐÕÐ¡£¶À¹Â¾Å½£ÒªÖ¼ÔÚÓÚ¡¸Îò¡¹£¬²»¿É¾ÐÄà²»»¯£¬½²¾¿ÁÏµÐ
»úÏÈ£¬³öÆæÖÆÊ¤¡£Í¨ÏþÁË¾Å½£½£Òâ£¬ÔòÎÞËùÊ©¶ø²»¿É¡£
    ¶À¹Â¾Å½££¬×Ô¡°×Ü¾÷Ê½¡±¡¢¡°ÆÆ½£Ê½¡±¡¢¡°ÆÆµ¶Ê½¡±ÒÔÖÁ¡°ÆÆ
Ç¹Ê½¡±¡¢¡°ÆÆ±ÞÊ½¡±¡¢¡°ÆÆË÷Ê½¡±¡¢¡°ÆÆÕÆÊ½¡±¡¢¡°ÆÆ¼ýÊ½¡±¶øµ½
µÚ¾Å½£¡°ÆÆÆøÊ½¡±¡£¾Å½£µÄµÚÒ»ÕÐ¡°×Ü¾÷Ê½¡±£¬ÓÐÖÖÖÖ±ä»¯£¬ÓÃÒÔ
ÌåÑÝ×Ü¾÷£¬±ãÓÚÐÞÏ°¡£µÚ¶þÕÐ¡°ÆÆ½£Ê½¡±£¬ÓÃÒÔÆÆ½âÆÕÌìÏÂ¸÷ÃÅ¸÷
ÅÉµÄ½£·¨¡£µÚÈýÕÐ¡°ÆÆµ¶Ê½¡±£¬ÓÃÒÔÆÆ½âµ¥µ¶¡¢Ë«µ¶¡¢ÁøÒ¶µ¶¡¢¹í
Í·µ¶¡¢´ó¿³µ¶¡¢Õ¶Âíµ¶ÖÖÖÖµ¶·¨¡£µÚËÄÕÐ¡°ÆÆÇ¹Ê½¡±£¬°üÀ¨ÆÆ½â³¤
Ç¹¡¢´óêª¡¢ÉßÃ¬¡¢ÆëÃ¼¹÷¡¢ÀÇÑÀ°ô¡¢°×À¯¸Ë¡¢ìøÕÈ¡¢·½±ã²ùÖÖÖÖ³¤
±øÈÐÖ®·¨¡£µÚÎåÕÐ¡°ÆÆ±ÞÊ½¡±£¬ÓÃÒÔÆÆ½â¸Ö±Þ¡¢Ìúïµ¡¢µãÑ¨éÓ¡¢¹Õ
×Ó¡¢¶êÃ¼´Ì¡¢Ø°Ê×¡¢°å¸«¡¢ÌúÅÆ¡¢°Ë½Çé³¡¢Ìú×µµÈµÈ¶Ì±øÈÐ£¬µÚÁù
ÕÐ¡°ÆÆË÷Ê½¡±£¬ÆÆ½âµÄÊÇ³¤Ë÷¡¢Èí±Þ¡¢Èý½Ú¹÷¡¢Á´×ÓÇ¹¡¢ÌúÁ´¡¢Óæ
Íø¡¢·É´¸Á÷ÐÇµÈµÈÈí±øÈÐ¡£µÚÆßÕÐ¡°ÆÆÕÆÊ½¡±£¬ÆÆµÄÊÇÈ­½ÅÖ¸ÕÆÉÏ
µÄ¹¦·ò£¬½«³¤È­¶Ì´ò¡¢ÇÜÄÃµãÑ¨¡¢Ä§×¦»¢×¦¡¢ÌúÉ³ÉñÕÆ£¬Öî°ãÈ­½Å
¹¦·ò¾¡Êý°üÀ¨ÄÚÔÚ¡£µÚ°ËÕÐ¡°ÆÆ¼ýÊ½¡±Õâ¸ö¡°¼ý¡±×Ö£¬Ôò×ÜÂÞÖî°ã
°µÆ÷£¬Á·ÕâÒ»½£Ê±£¬ÐëµÃÏÈÑ§Ìý·ç±æÆ÷Ö®Êõ£¬²»µ«ÒªÄÜÒÔÒ»±ú³¤½£
»÷¿ªµÐÈË·¢ÉäÀ´µÄÖÖÖÖ°µÆ÷£¬»¹Ðë½èÁ¦·´´ò£¬ÒÔµÐÈËÉäÀ´µÄ°µÆ÷·´
ÉäÉËµÐ¡£µÚ¾Å½£¡°ÆÆÆøÊ½¡±£¬ÊÇÎª¶Ô¸¶Éí¾ßÉÏ³ËÄÚ¹¦µÄµÐÈË¶øÓÃ£¬
Éñ¶øÃ÷Ö®£¬´æºõÒ»ÐÄ¡£

	Ñ§Ï°ÒªÇó£º
		Ö»ÄÜÏò·çÇåÑïÑ§Ï°
		×ÏÏ¼Éñ¹¦100¼¶
		ÄÚÁ¦600
HELP
	);
	return 1;
}

